FROM node:20.11-alpine

WORKDIR /app

RUN apk add --no-cache postgresql-client

COPY package.json yarn.lock ./

RUN yarn install

COPY . .
ENV NODE_ENV=development

RUN yarn prisma generate

RUN apk add --no-cache supervisor

COPY supervisord.conf /etc/supervisord.conf

EXPOSE 3001 5555

CMD ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]
